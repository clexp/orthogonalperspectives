{% extends "base.html" %}

{% block title %}Search Results - {{ SITENAME }}{% endblock %}

{% block content %}
<div class="row">
    <div class="twelve columns">
        <h1>Search Results</h1>
        <div id="search-results">
            <p>Searching for: <strong id="search-query"></strong></p>
            <div id="results-container">
                <p>Loading search results...</p>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const urlParams = new URLSearchParams(window.location.search);
    const query = urlParams.get('q');
    
    if (query) {
        document.getElementById('search-query').textContent = query;
        performSearch(query);
    } else {
        document.getElementById('results-container').innerHTML = '<p>No search query provided.</p>';
    }
    
    function performSearch(searchQuery) {
        const resultsContainer = document.getElementById('results-container');
        const searchTerms = searchQuery.toLowerCase().split(' ');
        
        // Load search index
        fetch('{{ SITEURL }}/search_index.json')
            .then(response => response.json())
            .then(searchData => {
                // Search through articles
                const results = searchData.filter(article => {
                    const searchText = (article.title + ' ' + article.content + ' ' + article.category + ' ' + article.tags.join(' ')).toLowerCase();
                    return searchTerms.some(term => searchText.includes(term));
                });
                
                // Display results
                if (results.length > 0) {
                    let html = '<div class="search-results-list">';
                    results.forEach(article => {
                        html += `
                            <div class="search-result-item">
                                <h3><a href="${article.url}">${article.title}</a></h3>
                                <p class="search-result-meta">
                                    <span class="category">${article.category}</span>
                                    ${article.tags.length > 0 ? ' | <span class="tags">' + article.tags.join(', ') + '</span>' : ''}
                                </p>
                                <p class="search-result-summary">${article.content.substring(0, 200)}...</p>
                            </div>
                        `;
                    });
                    html += '</div>';
                    resultsContainer.innerHTML = html;
                } else {
                    resultsContainer.innerHTML = '<p>No results found for your search query.</p>';
                }
            })
            .catch(error => {
                console.error('Error loading search index:', error);
                resultsContainer.innerHTML = '<p>Error loading search index. Please try again.</p>';
            });
    }
});
</script>

<style>
.search-results-list {
    margin-top: 20px;
}

.search-result-item {
    border-bottom: 1px solid #eee;
    padding: 15px 0;
    margin-bottom: 15px;
}

.search-result-item h3 {
    margin-bottom: 5px;
}

.search-result-item h3 a {
    color: #3498DB;
    text-decoration: none;
}

.search-result-item h3 a:hover {
    text-decoration: underline;
}

.search-result-meta {
    font-size: 12px;
    color: #666;
    margin-bottom: 8px;
}

.search-result-summary {
    color: #333;
    line-height: 1.5;
}

.category {
    font-weight: bold;
    color: #3498DB;
}

.tags {
    color: #666;
}
</style>
{% endblock %}
